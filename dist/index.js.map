{"version":3,"file":"index.js","sources":["../src/create-client.js","../src/reduxify-services.js","../src/reduxify-auth.js","../src/bind-services.js","../src/index.js"],"sourcesContent":["import feathers from '@feathersjs/client'\nimport axios from 'axios'\nimport io from 'socket.io-client'\n\n/**\n * Creates a FeathersJS client configured with either an Axois REST or socket.io connection.\n * @param  {boolean} useSockets When true, use a socketio connection to the server.\n * @param  {string}  apiUrl     URL of the API server\n * @param  {object}  auth       Optional. Object with keys: path, service, and storageKey (all strings)\n * @return {object}  The new FeathersJS client instance\n */\nexport default function createRestClient (useSockets, apiUrl, auth) {\n  const client = feathers()\n\n  if (useSockets) {\n    client.configure(feathers.socketio(io(apiUrl)))\n  } else {\n    client.configure(feathers.rest(apiUrl).axios(axios))\n  }\n\n  if (auth) {\n    client.configure(feathers.authentication(auth))\n  }\n\n  return client\n}\n","import { createAction, handleActions } from 'redux-actions'\n\nconst ID_FIELD = 'id'\nconst SORT_FUNCS = {\n  'nameAsc': store => (a, b) => store[a].name.localeCompare(store[b].name),\n  'nameDec': store => (a, b) => store[b].name.localeCompare(store[a].name),\n  'rankAsc': store => (a, b) => Number(store[a].rank) - Number(store[b].rank),\n  'rankDec': store => (a, b) => Number(store[b].rank) - Number(store[a].rank)\n}\n\nfunction createMethodReducer (name, type, idField) {\n  const DEFAULT = {\n    error: null,\n    loading: false,\n    result: null,\n    current: null,\n    store: {},\n    keys: [],\n    saved: 0\n  }\n\n  return {\n    [`${name}_PENDING`]: (state = DEFAULT, action) => ({\n      ...state,\n      error: null,\n      loading: true\n    }),\n    [`${name}_REJECTED`]: (state = DEFAULT, action) => ({\n      ...state,\n      error: action.payload,\n      loading: false\n    }),\n    [`${name}_FULFILLED`]: (state = DEFAULT, action) => {\n      let result = action.payload\n      let ret = {\n        ...state,\n        error: null,\n        loading: false,\n        result: result\n      }\n\n      switch (type) {\n        case 'find':\n          ret.current = null\n          if (result && Array.isArray(result)) {\n            result.reduce((acc, val) => {\n              if (!val[idField]) console.warn('Received object without valid idField')\n              else acc[val[idField]] = val\n              return acc\n            }, {})\n          } else {\n            ret.store = {}\n          }\n          break\n\n        case 'get':\n          ret.current = result\n          ret.store[result[idField]] = result\n          break\n\n        case 'create':\n        case 'patch':\n          ret.current = result\n          ret.saved = Date.now()\n          ret.store[result[idField]] = result\n          break\n\n        case 'remove':\n          ret.current = null\n          delete ret.store[result[idField]]\n          break\n\n        default:\n          throw new Error('Invalid method type ' + type)\n      }\n      ret.keys = Object.keys(ret.store)\n      return ret\n    }\n  }\n}\n\nfunction reduxifyService (app, actions, reducers, route, name, idField, sortFunctions) {\n  const SERVICE_NAME = `services/${name.toUpperCase()}_`\n\n  const service = app.service(route)\n  if (!service) throw new Error(`Could not find service ${route}`)\n\n  // Action types\n  const FIND = `${SERVICE_NAME}FIND`\n  const GET = `${SERVICE_NAME}GET`\n  const CREATE = `${SERVICE_NAME}CREATE`\n  const PATCH = `${SERVICE_NAME}PATCH`\n  const REMOVE = `${SERVICE_NAME}REMOVE`\n  const RESET = `${SERVICE_NAME}RESET`\n  const SET_CURRENT = `${SERVICE_NAME}SET_CURRENT`\n  const SORT = `${SERVICE_NAME}SORT`\n\n  actions[name] = {\n    find: createAction(FIND, (params) => ({ promise: service.find(params) })),\n    get: createAction(GET, (id, params) => ({ promise: service.get(id, params) })),\n    create: createAction(CREATE, (data, params) => ({ promise: service.create(data, params) })),\n    patch: createAction(PATCH, (id, data, params) => ({ promise: service.patch(id, data, params) })),\n    remove: createAction(REMOVE, (id, params) => ({ promise: service.remove(id, params) })),\n    setCurrent: createAction(SET_CURRENT),\n    sort: createAction(SORT),\n    reset: createAction(RESET)\n  }\n\n  reducers[name] = handleActions(Object.assign({},\n    createMethodReducer(FIND, 'find', idField),\n    createMethodReducer(GET, 'get', idField),\n    createMethodReducer(CREATE, 'create', idField),\n    createMethodReducer(PATCH, 'patch', idField),\n    createMethodReducer(REMOVE, 'remove', idField),\n    {\n      [SET_CURRENT]: (state, action) => {\n        if (state.loading) return state\n        return {\n          ...state,\n          current: state.store[action.payload]\n        }\n      },\n      [SORT]: (state, action) => {\n        if (state.loading) return state\n        let sortBy = action.payload\n        if (typeof sortBy === 'string') sortBy = sortFunctions[sortBy]\n        return {\n          ...state,\n          keys: [...state.keys].sort(sortBy(state.store))\n        }\n      },\n      [RESET]: (state, action) => {\n        if (state.loading) return state\n        return {\n          ...state,\n          error: null,\n          loading: false,\n          result: null,\n          current: null,\n          store: {},\n          keys: [],\n          saved: 0\n        }\n      }\n    }\n  ), {\n    error: null,\n    loading: false,\n    result: null,\n    current: null,\n    store: {},\n    saved: 0,\n    keys: []\n  })\n}\n\n/**\n * Creates redux bindings (action-creators and reducers) for each service\n * @param  {object} app           FeathersJS client instance\n * @param  {object} actions       Object wherein to store the service action-creators\n * @param  {object} reducers      Object wherein to store the service reducers\n * @param  {object} routeNameMap  Object with the following format: { serviceName: 'api/service-url', ... }\n * @param  {string} idField       Field used for ids, default `id`.\n * @param  {object} sortFunctions Object with named sorting functions, eg: { 'nameAsc': store => (a, b) => store[a].name.localeCompare(store[b].name) }\n */\nexport default function reduxifyServices (app, actions, reducers, routeNameMap, idField = ID_FIELD, sortFunctions = SORT_FUNCS) {\n  let names = Object.keys(routeNameMap)\n  for (let i = 0; i < names.length; i++) {\n    reduxifyService(app, actions, reducers, routeNameMap[names[i]], names[i], idField, sortFunctions)\n  }\n}\n","import { createAction, handleActions } from 'redux-actions'\n\n/**\n * Creates Redux bindings (reducers and actions) for the FeathersJS authentication service\n * @param {object}    app            FeathersJS client instance\n * @param {object}    actions        Object wherein to store the service action-creators\n * @param {object}    reducers       Object wherein to store the service reducers\n * @param {function}  authInitialize Optional. Function that runs after the user has authenticated.\n *                                   Takes in `data`, and should return it afterwards.\n */\nexport default function reduxifyAuth (app, actions, reducers, authInitialize = (data => data)) {\n  // ACTION TYPES\n  const AUTHENTICATE = 'auth/AUTHENTICATE'\n  const LOGOUT = 'auth/LOGOUT'\n  const USER = 'auth/USER'\n\n  // ACTION CREATORS\n  actions.auth = {\n    // Note: action.payload in reducer will have the value of .data below\n    authenticate: createAction(\n      AUTHENTICATE, (p) => ({\n        promise: app.authenticate(p).then(authInitialize),\n        data: undefined\n      })\n    ),\n    logout: createAction(LOGOUT),\n    user: createAction(USER)\n  }\n\n  // REDUCER\n  reducers.auth = handleActions(\n    {\n      [`${AUTHENTICATE}_PENDING`]: (state, action) => {\n        return ({\n          ...state,\n          errors: null,\n          loading: true,\n          valid: false,\n          admin: false,\n          user: null,\n          token: null,\n          ignorePendingAuth: false\n        })\n      },\n\n      [`${AUTHENTICATE}_FULFILLED`]: (state, action) => {\n        const user = action.payload.user\n\n        if (state.ignorePendingAuth) {\n          // A logout was dispatched between the authentication being started and completed\n          app.logout()\n\n          return {\n            ...state,\n            errors: null,\n            loading: false,\n            valid: false,\n            admin: false,\n            data: null,\n            token: null,\n            ignorePendingAuth: false\n          }\n        }\n\n        return {\n          ...state,\n          errors: null,\n          loading: false,\n          valid: true,\n          admin: user.admin || false,\n          user: user,\n          token: action.payloadtoken,\n          ignorePendingAuth: false\n        }\n      },\n\n      [`${AUTHENTICATE}_REJECTED`]: (state, action) => {\n        return {\n          ...state,\n          // action.payload = { name: \"NotFound\", message: \"No record found for id 'G6HJ45'\",\n          //   code:404, className: \"not-found\" }\n          errors: action.payload,\n          loading: false,\n          valid: false,\n          admin: false,\n          user: null,\n          token: null,\n          ignorePendingAuth: false\n        }\n      },\n\n      [LOGOUT]: (state, action) => {\n        app.logout()\n\n        return ({\n          ...state,\n          errors: null,\n          loading: null,\n          valid: false,\n          admin: false,\n          user: null,\n          token: null,\n          // Ignore the result if an authentication has been started\n          ignorePendingAuth: state.isLoading\n        })\n      },\n\n      [USER]: (state, action) => {\n        let user = state.user\n        if (user) {\n          user = { ...user, ...action.payload }\n        }\n\n        return ({\n          ...state,\n          errors: null,\n          loading: null,\n          valid: false,\n          admin: user.admin,\n          user: user,\n          // A logout may be dispatched between the authentication being started and completed\n          ignorePendingAuth: false\n        })\n      }\n    },\n    {\n      errors: null,\n      loading: false,\n      valid: false,\n      admin: false,\n      user: null,\n      ignorePendingAuth: false\n    }\n  )\n}\n","import { bindActionCreators } from 'redux'\n\n/**\n * Method to bind a given dispatch function with the passed services.\n *\n * This helps with not having to pass down store.dispatch as a prop everywhere\n * Read More: http://redux.js.org/docs/api/bindActionCreators.html\n *\n * @param  {object}   services        Using the default reduxifyService method\n * @param  {function} dispatch        The relevant store.dispatch function which is to be bounded to actionCreators\n * @param  {array}    targetActions   List of action names to be targeted for binding\n * @return {object}                   Returns the new services object with the bounded action creators\n */\nexport default function (dispatch, services, targetActions) {\n  targetActions = targetActions || [\n    // default targets from feathers-redux\n    'find',\n    'get',\n    'create',\n    'patch',\n    'remove',\n    'reset',\n    'setCurrent',\n    'sort',\n    // couple more optional ones in case feathers-reduxify-authentication is being used\n    'authenticate',\n    'logout'\n  ]\n\n  const serviceNames = Object.keys(services)\n  // map over the services object to get every service\n  serviceNames.forEach(_name => {\n    const methodNames = Object.keys(services[_name])\n\n    // map over every method in the service\n    methodNames.forEach(_method => {\n      // if method is in targeted actions then replace it with bounded method\n      if (targetActions.includes(_method)) {\n        services[_name][_method] = bindActionCreators(\n          services[_name][_method],\n          dispatch\n        )\n      }\n    })\n  })\n\n  return services\n}\n","import thunk from 'redux-thunk'\nimport promiseMiddleware from 'redux-promise-middleware'\nimport createClient from './create-client'\nimport reduxifyServices from './reduxify-services'\nimport reduxifyAuth from './reduxify-auth'\nimport bindServicesWithDispatch from './bind-services'\n\nlet client\nlet services\nlet serviceReducers\nlet serviceNames\nlet servicesBound = false\n\nexport default {\n  /**\n   * Creates the FeathersJS client and configures auth and services\n   * @param  {boolean}  options.useSockets      When true, a socket.io connection to the API server will be created\n   * @param  {string}   options.apiUrl          URL to the API server\n   * @param  {object}   options.serviceNameMap  Object with serviceName as the keys, and remote service-url as the values\n   * @param  {object}   options.authConfig      Optional. Object with keys: path, service, and storageKey (all strings)\n   * @param  {function} options.authInitalize   Optional. Function that runs after the user has authenticated. Takes in\n   *                                            `data`, and should return it afterwards.\n   * @param  {string}   options.idField         Optional. Field returned by server that has the `id` value. Default 'id'\n   * @param  {object}   options.sortFunctions   Optional. Object with the name of a sort function as the key and a\n   *                                            function that takes in the store and returns a valid sort function as\n   *                                            the value. Ex: `store => (a, b) => store[a].name.localeCompare(store[b].name)`\n   * @return {object}   An object with all serviceNames mapped to objects with their action creators.\n   */\n  setup: ({ useSockets, apiUrl, serviceNameMap, authConfig, authInitalize, idField, sortFunctions }) => {\n    client = createClient(useSockets, apiUrl, authConfig)\n\n    services = {}\n    serviceReducers = {}\n    serviceNames = Object.keys(serviceNameMap)\n    reduxifyServices(client, services, serviceReducers, serviceNameMap, idField, sortFunctions)\n\n    if (authConfig) {\n      serviceNames.unshift('auth')\n      reduxifyAuth(client, services, serviceReducers, authInitalize)\n    }\n\n    return services\n  },\n\n  /**\n   * Returns the FeathersJS client instance (after setup() has been called)\n   */\n  getClient: () => client,\n\n  /**\n   * Returns the services object, which has all their action-creators (after setup() has been called). If the store\n   * param is passed and the services have not been bound with the store's dispatch function, the binding takes place.\n   * @param  {object} store Redux store\n   */\n  getServices: (store) => {\n    if (store && !servicesBound) {\n      bindServicesWithDispatch(store.dispatch, services)\n    }\n    return services\n  },\n\n  /**\n   * Returns reducers for all services in a object where the keys are service names and the values are their reducers\n   */\n  getServiceReducers: () => serviceReducers,\n\n  /**\n   * Helper function for redux store. Returns an array with reduxThunk and reduxPromimseMiddleware, which are needed to\n   * process the events from the services. If you are already using these two middleware libraries, you do not need to\n   * use this function.\n   */\n  getMiddleware: () => ([ thunk, promiseMiddleware() ])\n}\n"],"names":["createRestClient","useSockets","apiUrl","auth","client","feathers","configure","socketio","io","rest","axios","authentication","ID_FIELD","SORT_FUNCS","a","b","store","name","localeCompare","Number","rank","createMethodReducer","type","idField","DEFAULT","state","action","payload","result","ret","current","Array","isArray","reduce","acc","val","console","warn","saved","Date","now","Error","keys","Object","reduxifyService","app","actions","reducers","route","sortFunctions","SERVICE_NAME","toUpperCase","service","FIND","GET","CREATE","PATCH","REMOVE","RESET","SET_CURRENT","SORT","createAction","params","promise","find","id","get","data","create","patch","remove","handleActions","assign","loading","sortBy","sort","reduxifyServices","routeNameMap","names","i","length","reduxifyAuth","authInitialize","AUTHENTICATE","LOGOUT","USER","p","authenticate","then","undefined","user","ignorePendingAuth","logout","admin","payloadtoken","isLoading","dispatch","services","targetActions","serviceNames","forEach","methodNames","_name","includes","_method","bindActionCreators","serviceReducers","servicesBound","serviceNameMap","authConfig","authInitalize","createClient","unshift","thunk","promiseMiddleware"],"mappings":";;;;;;;;;;;;AAIA;;;;;;;AAOA,AAAe,SAASA,gBAAT,CAA2BC,UAA3B,EAAuCC,MAAvC,EAA+CC,IAA/C,EAAqD;MAC5DC,SAASC,UAAf;;MAEIJ,UAAJ,EAAgB;WACPK,SAAP,CAAiBD,SAASE,QAAT,CAAkBC,GAAGN,MAAH,CAAlB,CAAjB;GADF,MAEO;WACEI,SAAP,CAAiBD,SAASI,IAAT,CAAcP,MAAd,EAAsBQ,KAAtB,CAA4BA,KAA5B,CAAjB;;;MAGEP,IAAJ,EAAU;WACDG,SAAP,CAAiBD,SAASM,cAAT,CAAwBR,IAAxB,CAAjB;;;SAGKC,MAAP;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtBF,IAAMQ,WAAW,IAAjB;AACA,IAAMC,aAAa;aACN;WAAS,UAACC,CAAD,EAAIC,CAAJ;aAAUC,MAAMF,CAAN,EAASG,IAAT,CAAcC,aAAd,CAA4BF,MAAMD,CAAN,EAASE,IAArC,CAAV;KAAT;GADM;aAEN;WAAS,UAACH,CAAD,EAAIC,CAAJ;aAAUC,MAAMD,CAAN,EAASE,IAAT,CAAcC,aAAd,CAA4BF,MAAMF,CAAN,EAASG,IAArC,CAAV;KAAT;GAFM;aAGN;WAAS,UAACH,CAAD,EAAIC,CAAJ;aAAUI,OAAOH,MAAMF,CAAN,EAASM,IAAhB,IAAwBD,OAAOH,MAAMD,CAAN,EAASK,IAAhB,CAAlC;KAAT;GAHM;aAIN;WAAS,UAACN,CAAD,EAAIC,CAAJ;aAAUI,OAAOH,MAAMD,CAAN,EAASK,IAAhB,IAAwBD,OAAOH,MAAMF,CAAN,EAASM,IAAhB,CAAlC;KAAT;;CAJb;;AAOA,SAASC,mBAAT,CAA8BJ,IAA9B,EAAoCK,IAApC,EAA0CC,OAA1C,EAAmD;;;MAC3CC,UAAU;WACP,IADO;aAEL,KAFK;YAGN,IAHM;aAIL,IAJK;WAKP,EALO;UAMR,EANQ;WAOP;GAPT;;yCAWMP,IADN,eACuB;QAACQ,KAAD,uEAASD,OAAT;AAAA,AAAA,wBAChBC,KADgB;aAEZ,IAFY;eAGV;;GAJb,wBAMMR,IANN,gBAMwB;QAACQ,KAAD,uEAASD,OAAT;QAAkBE,MAAlB;wBACjBD,KADiB;aAEbC,OAAOC,OAFM;eAGX;;GATb,wBAWMV,IAXN,iBAWyB,qBAA6B;QAA5BQ,KAA4B,uEAApBD,OAAoB;QAAXE,MAAW;;QAC9CE,SAASF,OAAOC,OAApB;QACIE,mBACCJ,KADD;aAEK,IAFL;eAGO,KAHP;cAIMG;MAJV;;YAOQN,IAAR;WACO,MAAL;YACMQ,OAAJ,GAAc,IAAd;YACIF,UAAUG,MAAMC,OAAN,CAAcJ,MAAd,CAAd,EAAqC;iBAC5BK,MAAP,CAAc,UAACC,GAAD,EAAMC,GAAN,EAAc;gBACtB,CAACA,IAAIZ,OAAJ,CAAL,EAAmBa,QAAQC,IAAR,CAAa,uCAAb,EAAnB,KACKH,IAAIC,IAAIZ,OAAJ,CAAJ,IAAoBY,GAApB;mBACED,GAAP;WAHF,EAIG,EAJH;SADF,MAMO;cACDlB,KAAJ,GAAY,EAAZ;;;;WAIC,KAAL;YACMc,OAAJ,GAAcF,MAAd;YACIZ,KAAJ,CAAUY,OAAOL,OAAP,CAAV,IAA6BK,MAA7B;;;WAGG,QAAL;WACK,OAAL;YACME,OAAJ,GAAcF,MAAd;YACIU,KAAJ,GAAYC,KAAKC,GAAL,EAAZ;YACIxB,KAAJ,CAAUY,OAAOL,OAAP,CAAV,IAA6BK,MAA7B;;;WAGG,QAAL;YACME,OAAJ,GAAc,IAAd;eACOD,IAAIb,KAAJ,CAAUY,OAAOL,OAAP,CAAV,CAAP;;;;cAIM,IAAIkB,KAAJ,CAAU,yBAAyBnB,IAAnC,CAAN;;QAEAoB,IAAJ,GAAWC,OAAOD,IAAP,CAAYb,IAAIb,KAAhB,CAAX;WACOa,GAAP;GAvDJ;;;AA4DF,SAASe,eAAT,CAA0BC,GAA1B,EAA+BC,OAA/B,EAAwCC,QAAxC,EAAkDC,KAAlD,EAAyD/B,IAAzD,EAA+DM,OAA/D,EAAwE0B,aAAxE,EAAuF;;;MAC/EC,6BAA2BjC,KAAKkC,WAAL,EAA3B,MAAN;;MAEMC,UAAUP,IAAIO,OAAJ,CAAYJ,KAAZ,CAAhB;MACI,CAACI,OAAL,EAAc,MAAM,IAAIX,KAAJ,6BAAoCO,KAApC,CAAN;;;MAGRK,OAAUH,YAAV,SAAN;MACMI,MAASJ,YAAT,QAAN;MACMK,SAAYL,YAAZ,WAAN;MACMM,QAAWN,YAAX,UAAN;MACMO,SAAYP,YAAZ,WAAN;MACMQ,QAAWR,YAAX,UAAN;MACMS,cAAiBT,YAAjB,gBAAN;MACMU,OAAUV,YAAV,SAAN;;UAEQjC,IAAR,IAAgB;UACR4C,0BAAaR,IAAb,EAAmB,UAACS,MAAD;aAAa,EAAEC,SAASX,QAAQY,IAAR,CAAaF,MAAb,CAAX,EAAb;KAAnB,CADQ;SAETD,0BAAaP,GAAb,EAAkB,UAACW,EAAD,EAAKH,MAAL;aAAiB,EAAEC,SAASX,QAAQc,GAAR,CAAYD,EAAZ,EAAgBH,MAAhB,CAAX,EAAjB;KAAlB,CAFS;YAGND,0BAAaN,MAAb,EAAqB,UAACY,IAAD,EAAOL,MAAP;aAAmB,EAAEC,SAASX,QAAQgB,MAAR,CAAeD,IAAf,EAAqBL,MAArB,CAAX,EAAnB;KAArB,CAHM;WAIPD,0BAAaL,KAAb,EAAoB,UAACS,EAAD,EAAKE,IAAL,EAAWL,MAAX;aAAuB,EAAEC,SAASX,QAAQiB,KAAR,CAAcJ,EAAd,EAAkBE,IAAlB,EAAwBL,MAAxB,CAAX,EAAvB;KAApB,CAJO;YAKND,0BAAaJ,MAAb,EAAqB,UAACQ,EAAD,EAAKH,MAAL;aAAiB,EAAEC,SAASX,QAAQkB,MAAR,CAAeL,EAAf,EAAmBH,MAAnB,CAAX,EAAjB;KAArB,CALM;gBAMFD,0BAAaF,WAAb,CANE;UAORE,0BAAaD,IAAb,CAPQ;WAQPC,0BAAaH,KAAb;GART;;WAWSzC,IAAT,IAAiBsD,2BAAc5B,OAAO6B,MAAP,CAAc,EAAd,EAC7BnD,oBAAoBgC,IAApB,EAA0B,MAA1B,EAAkC9B,OAAlC,CAD6B,EAE7BF,oBAAoBiC,GAApB,EAAyB,KAAzB,EAAgC/B,OAAhC,CAF6B,EAG7BF,oBAAoBkC,MAApB,EAA4B,QAA5B,EAAsChC,OAAtC,CAH6B,EAI7BF,oBAAoBmC,KAApB,EAA2B,OAA3B,EAAoCjC,OAApC,CAJ6B,EAK7BF,oBAAoBoC,MAApB,EAA4B,QAA5B,EAAsClC,OAAtC,CAL6B,uDAO1BoC,WAP0B,EAOZ,UAAClC,KAAD,EAAQC,MAAR,EAAmB;QAC5BD,MAAMgD,OAAV,EAAmB,OAAOhD,KAAP;wBAEdA,KADL;eAEWA,MAAMT,KAAN,CAAYU,OAAOC,OAAnB;;GAXc,kCAc1BiC,IAd0B,EAcnB,UAACnC,KAAD,EAAQC,MAAR,EAAmB;QACrBD,MAAMgD,OAAV,EAAmB,OAAOhD,KAAP;QACfiD,SAAShD,OAAOC,OAApB;QACI,OAAO+C,MAAP,KAAkB,QAAtB,EAAgCA,SAASzB,cAAcyB,MAAd,CAAT;wBAE3BjD,KADL;YAEQ,4BAAIA,MAAMiB,IAAV,GAAgBiC,IAAhB,CAAqBD,OAAOjD,MAAMT,KAAb,CAArB;;GApBiB,kCAuB1B0C,KAvB0B,EAuBlB,UAACjC,KAAD,EAAQC,MAAR,EAAmB;QACtBD,MAAMgD,OAAV,EAAmB,OAAOhD,KAAP;wBAEdA,KADL;aAES,IAFT;eAGW,KAHX;cAIU,IAJV;eAKW,IALX;aAMS,EANT;YAOQ,EAPR;aAQS;;GAjCgB,mBAAd,EAqCd;WACM,IADN;aAEQ,KAFR;YAGO,IAHP;aAIQ,IAJR;WAKM,EALN;WAMM,CANN;UAOK;GA5CS,CAAjB;;;;;;;;;;;;AAyDF,AAAe,SAASmD,gBAAT,CAA2B/B,GAA3B,EAAgCC,OAAhC,EAAyCC,QAAzC,EAAmD8B,YAAnD,EAAiH;MAAhDtD,OAAgD,uEAAtCX,QAAsC;MAA5BqC,aAA4B,uEAAZpC,UAAY;;MAC1HiE,QAAQnC,OAAOD,IAAP,CAAYmC,YAAZ,CAAZ;OACK,IAAIE,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;oBACrBlC,GAAhB,EAAqBC,OAArB,EAA8BC,QAA9B,EAAwC8B,aAAaC,MAAMC,CAAN,CAAb,CAAxC,EAAgED,MAAMC,CAAN,CAAhE,EAA0ExD,OAA1E,EAAmF0B,aAAnF;;;;ACtKJ;;;;;;;;AAQA,AAAe,SAASgC,YAAT,CAAuBpC,GAAvB,EAA4BC,OAA5B,EAAqCC,QAArC,EAAgF;;;MAAjCmC,cAAiC,uEAAf;WAAQf,IAAR;GAAe;;;MAEvFgB,eAAe,mBAArB;MACMC,SAAS,aAAf;MACMC,OAAO,WAAb;;;UAGQlF,IAAR,GAAe;;kBAEC0D,0BACZsB,YADY,EACE,UAACG,CAAD;aAAQ;iBACXzC,IAAI0C,YAAJ,CAAiBD,CAAjB,EAAoBE,IAApB,CAAyBN,cAAzB,CADW;cAEdO;OAFM;KADF,CAFD;YAQL5B,0BAAauB,MAAb,CARK;UASPvB,0BAAawB,IAAb;;;GATR,CAaAtC,SAAS5C,IAAT,GAAgBoE,gFAERY,YAFQ,eAEiB,mBAAC1D,KAAD,EAAQC,MAAR,EAAmB;wBAEzCD,KADL;cAEU,IAFV;eAGW,IAHX;aAIS,KAJT;aAKS,KALT;YAMQ,IANR;aAOS,IAPT;yBAQqB;;GAXX,kCAeR0D,YAfQ,iBAemB,mBAAC1D,KAAD,EAAQC,MAAR,EAAmB;QAC1CgE,OAAOhE,OAAOC,OAAP,CAAe+D,IAA5B;;QAEIjE,MAAMkE,iBAAV,EAA6B;;UAEvBC,MAAJ;;0BAGKnE,KADL;gBAEU,IAFV;iBAGW,KAHX;eAIS,KAJT;eAKS,KALT;cAMQ,IANR;eAOS,IAPT;2BAQqB;;;;wBAKlBA,KADL;cAEU,IAFV;eAGW,KAHX;aAIS,IAJT;aAKSiE,KAAKG,KAAL,IAAc,KALvB;YAMQH,IANR;aAOShE,OAAOoE,YAPhB;yBAQqB;;GA1CX,kCA8CRX,YA9CQ,gBA8CkB,mBAAC1D,KAAD,EAAQC,MAAR,EAAmB;wBAE1CD,KADL;;;cAIUC,OAAOC,OAJjB;eAKW,KALX;aAMS,KANT;aAOS,KAPT;YAQQ,IARR;aASS,IATT;yBAUqB;;GAzDX,kCA6DXyD,MA7DW,EA6DF,UAAC3D,KAAD,EAAQC,MAAR,EAAmB;QACvBkE,MAAJ;;wBAGKnE,KADL;cAEU,IAFV;eAGW,IAHX;aAIS,KAJT;aAKS,KALT;YAMQ,IANR;aAOS,IAPT;;yBASqBA,MAAMsE;;GAzEjB,kCA6EXV,IA7EW,EA6EJ,UAAC5D,KAAD,EAAQC,MAAR,EAAmB;QACrBgE,OAAOjE,MAAMiE,IAAjB;QACIA,IAAJ,EAAU;0BACIA,IAAZ,EAAqBhE,OAAOC,OAA5B;;;wBAIGF,KADL;cAEU,IAFV;eAGW,IAHX;aAIS,KAJT;aAKSiE,KAAKG,KALd;YAMQH,IANR;;yBAQqB;;GA3FX,oBA+Fd;YACU,IADV;aAEW,KAFX;WAGS,KAHT;WAIS,KAJT;UAKQ,IALR;uBAMqB;GArGP,CAAhB;;;AC5BF;;;;;;;;;;;AAWA,AAAe,mCAAUM,QAAV,EAAoBC,QAApB,EAA8BC,aAA9B,EAA6C;kBAC1CA,iBAAiB;;QAAA,EAG/B,KAH+B,EAI/B,QAJ+B,EAK/B,OAL+B,EAM/B,QAN+B,EAO/B,OAP+B,EAQ/B,YAR+B,EAS/B,MAT+B;;gBAAA,EAY/B,QAZ+B,CAAjC;;MAeMC,eAAexD,OAAOD,IAAP,CAAYuD,QAAZ,CAArB;;eAEaG,OAAb,CAAqB,iBAAS;QACtBC,cAAc1D,OAAOD,IAAP,CAAYuD,SAASK,KAAT,CAAZ,CAApB;;;gBAGYF,OAAZ,CAAoB,mBAAW;;UAEzBF,cAAcK,QAAd,CAAuBC,OAAvB,CAAJ,EAAqC;iBAC1BF,KAAT,EAAgBE,OAAhB,IAA2BC,yBACzBR,SAASK,KAAT,EAAgBE,OAAhB,CADyB,EAEzBR,QAFyB,CAA3B;;KAHJ;GAJF;;SAeOC,QAAP;;;ACvCF,IAAI7F,eAAJ;AACA,IAAI6F,iBAAJ;AACA,IAAIS,wBAAJ;AACA,IAAIP,qBAAJ;AACA,IAAIQ,gBAAgB,KAApB;;AAEA,YAAe;;;;;;;;;;;;;;;SAeN,qBAA+F;QAA5F1G,UAA4F,QAA5FA,UAA4F;QAAhFC,MAAgF,QAAhFA,MAAgF;QAAxE0G,cAAwE,QAAxEA,cAAwE;QAAxDC,UAAwD,QAAxDA,UAAwD;QAA5CC,aAA4C,QAA5CA,aAA4C;QAA7BvF,OAA6B,QAA7BA,OAA6B;QAApB0B,aAAoB,QAApBA,aAAoB;;aAC3F8D,iBAAa9G,UAAb,EAAyBC,MAAzB,EAAiC2G,UAAjC,CAAT;;eAEW,EAAX;sBACkB,EAAlB;mBACelE,OAAOD,IAAP,CAAYkE,cAAZ,CAAf;qBACiBxG,MAAjB,EAAyB6F,QAAzB,EAAmCS,eAAnC,EAAoDE,cAApD,EAAoErF,OAApE,EAA6E0B,aAA7E;;QAEI4D,UAAJ,EAAgB;mBACDG,OAAb,CAAqB,MAArB;mBACa5G,MAAb,EAAqB6F,QAArB,EAA+BS,eAA/B,EAAgDI,aAAhD;;;WAGKb,QAAP;GA5BW;;;;;aAkCF;WAAM7F,MAAN;GAlCE;;;;;;;eAyCA,qBAACY,KAAD,EAAW;QAClBA,SAAS,CAAC2F,aAAd,EAA6B;+BACF3F,MAAMgF,QAA/B,EAAyCC,QAAzC;;WAEKA,QAAP;GA7CW;;;;;sBAmDO;WAAMS,eAAN;GAnDP;;;;;;;iBA0DE;WAAO,CAAEO,KAAF,EAASC,mBAAT,CAAP;;CA1DjB;;;;"}